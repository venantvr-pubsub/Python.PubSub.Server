<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Real-Time Activity Map</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/static/style.css" rel="stylesheet">
    <style>
        /* --- Nouveaux styles pour le graphe D3 --- */
        body {
            overflow: hidden; /* Empêche le scroll */
        }

        #activity-graph-container {
            width: 100%;
            height: calc(100vh - 100px); /* Hauteur de la vue moins la barre de nav */
            cursor: grab;
        }

        /* Style des liens (flèches) */
        .link {
            stroke-opacity: 0.6;
            stroke-width: 2px;
        }

        .link.publish {
            stroke: #28a745; /* Vert pour publish */
        }

        .link.consume {
            stroke: #ffab40; /* Orange pour subscribe/consume */
        }

        /* Style des nœuds (disques) */
        .node circle {
            stroke: #fff;
            stroke-width: 2px;
        }

        .node.producer circle {
            fill: #007bff;
        }

        /* Bleu pour les producteurs */
        .node.topic circle {
            fill: #6c757d;
        }

        /* Gris pour les topics */
        .node.consumer circle {
            fill: #dc3545;
        }

        /* Rouge pour les consommateurs */

        /* Style du texte des nœuds */
        .node text {
            pointer-events: none;
            font-family: sans-serif;
            font-size: 12px;
            fill: #f8f9fa; /* Texte clair */
            text-shadow: 0 1px 0 #343a40, 1px 0 0 #343a40, 0 -1px 0 #343a40, -1px 0 0 #343a40;
        }

        /* Animation pour les liens actifs */
        .link.active {
            animation: pulse 1s ease-out;
        }

        @keyframes pulse {
            0% {
                stroke-opacity: 1;
                stroke-width: 4px;
            }
            100% {
                stroke-opacity: 0.6;
                stroke-width: 2px;
            }
        }
    </style>
</head>
<body class="p-4">

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="#">Pub/Sub Monitor</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/client.html">Control Panel</a>
                </li>
                <li class="nav-item">
                    <a aria-current="page" class="nav-link active" href="/activity.html">Activity Map</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid" style="padding-top: 70px;">
    <h1 class="text-center">Real-Time Activity Map</h1>
    <div id="activity-graph-container">
        <svg id="activity-svg" width="100%" height="100%"></svg>
    </div>
</div>

<script src="/static/graph.js"></script>
</body>
</html>
